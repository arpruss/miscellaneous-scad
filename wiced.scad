use <ribbon.scad>;

//<params>
baseHeight = 1.4;
screwHoleDiameter = 3;
//</params>

module dummy() {}

snapThickness = 2;
snapStart = 7.5;
snapInset = 2;
snapRatio = 1.3;
edgeWidth = 1;
edgeHeight = 1;

function sum(points,n=0) =
    len(points) <= n ? [for(i=[0:len(points[0])-1]) 0] : points[n]+sum(points,n=n+1);
function center(points) = sum(points)/len(points);

echo([1,2]+[3,4]);
echo(sum([[1,2],[3,4]]));

center_wiced_1 = [-17.717180560,0.558798583];
size_wiced_1 = [7.982450011,83.674874782];
stroke_width_wiced_1 = 0.282222224;
color_wiced_1 = [0.00000,0.00000,1.00000];
center_screw_hole_1 = [-1.496709402,-37.048051645];
size_screw_hole_1 = [0.000000000,1.496709298];
stroke_width_screw_hole_1 = 0.282222224;
color_screw_hole_1 = [0.00000,0.00000,0.00000];
center_wiced_3 = [2.239044119,-30.992748155];
size_wiced_3 = [0.000000000,1.496709298];
stroke_width_wiced_3 = 0.282222224;
color_wiced_3 = [0.00000,0.00000,0.00000];
center_wiced_4 = [-2.825835103,-30.564363074];
size_wiced_4 = [0.000000000,1.496709349];
stroke_width_wiced_4 = 0.282222224;
color_wiced_4 = [0.00000,0.00000,0.00000];
center_wiced_5 = [-2.825835103,-30.564363074];
size_wiced_5 = [0.000000000,1.496709349];
stroke_width_wiced_5 = 0.282222224;
color_wiced_5 = [0.00000,0.00000,0.00000];
center_outline = [-7.473189848,-28.615604412];
size_outline = [20.681288694,0.000000000];
stroke_width_outline = 0.000634402;
color_outline = [1.00000,0.00000,0.00000];
center_wiced_7 = [-20.918297032,-10.128423571];
size_wiced_7 = [0.000000000,1.496709324];
stroke_width_wiced_7 = 0.282222224;
color_wiced_7 = [0.00000,0.00000,0.00000];
center_wiced_8 = [-20.817503338,0.505308897];
size_wiced_8 = [0.000000000,1.496709313];
stroke_width_wiced_8 = 0.282222224;
color_wiced_8 = [0.00000,0.00000,0.00000];
center_wiced_9 = [18.382028625,13.952811003];
size_wiced_9 = [0.000000000,1.496709298];
stroke_width_wiced_9 = 0.282222224;
color_wiced_9 = [0.00000,0.00000,0.00000];
center_wiced_10 = [17.063500481,20.189086669];
size_wiced_10 = [0.000000000,1.496709298];
stroke_width_wiced_10 = 0.282222224;
color_wiced_10 = [0.00000,0.00000,0.00000];
center_wiced_11 = [-10.732536103,25.677021873];
size_wiced_11 = [0.000000000,1.496709349];
stroke_width_wiced_11 = 0.282222224;
color_wiced_11 = [0.00000,0.00000,0.00000];
center_wiced_12 = [0.243335026,28.955529685];
size_wiced_12 = [0.000000000,1.496709298];
stroke_width_wiced_12 = 0.282222224;
color_wiced_12 = [0.00000,0.00000,0.00000];
center_screw_hole_2 = [-1.496709402,35.724968278];
size_screw_hole_2 = [0.000000000,1.496709298];
stroke_width_screw_hole_2 = 0.282222224;
color_screw_hole_2 = [0.00000,0.00000,0.00000];
// paths for wiced_1
points_wiced_1_1 = [ [3.991225005,41.837437391],[31.443138712,41.837437391],[33.000437455,41.684056858],[34.497890081,41.229809586],[35.877950324,40.492152044],[37.087583245,39.499431996],[38.080303328,38.289799118],[38.817960896,36.909738923],[39.272208184,35.412286350],[39.425588723,33.854987662],[39.425588723,-33.854987662],[39.272208184,-35.412286350],[38.817960896,-36.909738923],[38.080303328,-38.289799118],[37.087583245,-39.499431996],[35.877950324,-40.492152044],[34.497890081,-41.229809586],[33.000437455,-41.684056858],[31.443138712,-41.837437391],[3.991225005,-41.837437391],[2.433926262,-41.684056858],[0.936473637,-41.229809586],[-0.443586607,-40.492152044],[-1.653219528,-39.499431996],[-2.645939610,-38.289799118],[-3.383597179,-36.909738923],[-3.837844467,-35.412286350],[-3.991225005,-33.854987662],[-3.991225005,33.854987662],[-3.837844467,35.412286350],[-3.383597179,36.909738923],[-2.645939610,38.289799118],[-1.653219528,39.499431996],[-0.443586607,40.492152044],[0.936473637,41.229809586],[2.433926262,41.684056858],[3.991225005,41.837437391] ];

// paths for screw_hole_1
points_screw_hole_1_1 = [ [0.000000000,0.748354649],[0.113930234,1.321120504],[0.438376052,1.806687946],[0.923943522,2.131133737],[1.496709402,2.245063947],[2.069475281,2.131133737],[2.555042751,1.806687946],[2.879488570,1.321120504],[2.993418803,0.748354649],[2.879488570,0.175588794],[2.555042751,-0.309978648],[2.069475281,-0.634424439],[1.496709402,-0.748354649],[0.923943522,-0.634424439],[0.438376052,-0.309978648],[0.113930234,0.175588794],[0.000000000,0.748354649] ];

// paths for wiced_3
points_wiced_3_1 = [ [0.000000000,0.748354649],[0.113930234,1.321120504],[0.438376052,1.806687946],[0.923943522,2.131133737],[1.496709402,2.245063947],[2.069475281,2.131133737],[2.555042751,1.806687946],[2.879488570,1.321120504],[2.993418803,0.748354649],[2.879488570,0.175588794],[2.555042751,-0.309978648],[2.069475281,-0.634424439],[1.496709402,-0.748354649],[0.923943522,-0.634424439],[0.438376052,-0.309978648],[0.113930234,0.175588794],[0.000000000,0.748354649] ];

// paths for wiced_4
points_wiced_4_1 = [ [0.000000000,0.748354674],[0.113930219,1.321120545],[0.438376034,1.806688005],[0.923943511,2.131133808],[1.496709402,2.245064023],[2.069475293,2.131133808],[2.555042769,1.806688005],[2.879488584,1.321120545],[2.993418803,0.748354674],[2.879488584,0.175588804],[2.555042769,-0.309978656],[2.069475293,-0.634424459],[1.496709402,-0.748354674],[0.923943511,-0.634424459],[0.438376034,-0.309978656],[0.113930219,0.175588804],[0.000000000,0.748354674] ];

// paths for wiced_5
points_wiced_5_1 = [ [0.000000000,0.748354674],[0.113930219,1.321120545],[0.438376034,1.806688005],[0.923943511,2.131133808],[1.496709402,2.245064023],[2.069475293,2.131133808],[2.555042769,1.806688005],[2.879488584,1.321120545],[2.993418803,0.748354674],[2.879488584,0.175588804],[2.555042769,-0.309978656],[2.069475293,-0.634424459],[1.496709402,-0.748354674],[0.923943511,-0.634424459],[0.438376034,-0.309978656],[0.113930219,0.175588804],[0.000000000,0.748354674] ];

// paths for outline
points_outline_1 = [ [21.902995563,48.610765007],[21.887669132,48.881525476],[21.655314513,49.296375910],[20.877668094,50.966482337],[20.526267552,51.479215198],[20.034484029,52.104602702],[19.650912975,52.429663432],[18.691382796,53.181427224],[18.332156231,53.372497311],[17.424250143,53.811268195],[16.861436929,54.095846970],[15.947906151,54.415401544],[14.757269833,54.601651275],[12.657734004,54.647439008],[10.479417603,54.351783717],[7.806644330,53.810556995],[7.247229072,53.693189241],[6.731183962,53.549603042],[6.510437142,53.414136377],[6.676549972,53.285797587],[7.054522089,53.221570512],[10.614941776,52.708228051],[10.993235274,52.637302785],[13.830446388,51.947057793],[14.203992908,51.818293905],[15.665178744,51.370805177],[16.138047733,51.195539534],[18.899600712,50.064488835],[19.523785972,49.753852483],[21.560022177,48.638583651],[21.765120479,48.553474955],[21.902995563,48.610765007] ];
points_outline_2 = [ [10.340644347,0.000000000],[8.704565396,0.088787110],[5.507970802,0.545253327],[4.456924421,0.804502658],[4.511796889,0.850335546],[3.200460474,1.220882737],[3.184158612,1.172209987],[3.231540902,1.093498210],[1.611534507,1.566530872],[-1.490482902,2.803595525],[-3.033689220,3.573889322],[-3.232614573,3.707783922],[-3.222074322,3.770375959],[-3.268513990,3.896388180],[-3.820045617,4.202834943],[-4.539752977,4.728701015],[-4.622029223,4.674796572],[-4.785570655,4.663060713],[-5.298467928,5.039295034],[-5.765271962,5.411311897],[-7.755102084,7.378366898],[-8.536911281,8.688573673],[-8.980776292,9.638724162],[-9.530054127,11.290012011],[-9.625253330,11.656034474],[-9.928622470,13.237023590],[-10.099206052,14.674545041],[-10.304644080,18.344006801],[-10.303515191,18.797958419],[-10.340644347,24.510212334],[-10.248459278,28.047269541],[-9.944717604,34.497198715],[-9.834825913,36.123865498],[-9.509863949,39.320458285],[-9.378715279,40.228367164],[-8.829273755,43.456255574],[-8.775403176,43.666415171],[-8.135881960,45.944363347],[-7.940990577,46.451316297],[-7.618864947,47.250758710],[-6.867581189,48.740003028],[-5.990606656,50.061590413],[-5.193266770,50.896282382],[-4.014630541,51.950715393],[-3.481591773,52.304768811],[-1.263511319,53.524397776],[-0.639326059,53.789810839],[2.122226920,54.836824228],[3.427343863,55.266719223],[6.964400065,56.232342546],[7.664246282,56.402959989],[9.962393182,56.837062918],[10.435262172,56.909498072],[12.630649842,57.205744796],[13.842526205,57.239754513],[14.956645374,57.171014882],[15.865739971,57.001127160],[18.022406046,56.343730012],[18.163824783,56.311590546],[19.669243309,55.511479265],[20.568558553,54.914867138],[22.001626588,53.561075375],[22.474495577,52.960811293],[23.476977157,51.369408177],[23.551190315,51.168581668],[23.929368102,50.482355520],[24.024578593,50.258440411],[24.860168058,47.763062594],[25.006748639,47.193752644],[25.708832878,43.519532617],[25.897783483,42.157920477],[26.125530119,39.991742883],[26.313482715,39.737176325],[26.558991713,39.413198270],[26.673028191,38.942164800],[26.769794785,35.930114300],[26.725513059,33.455781793],[26.200033965,32.601593561],[26.136760800,32.051339608],[26.103035244,31.053661486],[26.299188160,30.839796310],[26.536314804,30.570143210],[26.574834611,29.988182297],[26.489202742,27.687890589],[26.374564072,25.228973060],[26.225878113,24.088089739],[26.053754656,23.875154486],[25.677467405,23.629019316],[25.643701632,23.507677168],[25.197844133,18.041368627],[25.040925751,16.418650133],[24.689011565,13.274852656],[24.593558362,12.764154617],[23.974616792,10.040430802],[23.861256589,9.667925695],[23.130035727,7.678188495],[22.920711499,7.203219789],[21.856205940,5.315229342],[21.655080268,5.039512345],[20.650888421,3.838193958],[19.962149060,3.135601744],[19.130246829,2.409867307],[18.414268789,1.944906201],[17.528412723,1.322606208],[17.291978228,1.216377765],[16.035180553,0.713429548],[15.851403082,0.675611770],[13.962983591,0.211102220],[12.873227609,0.065517888],[10.340644347,0.000000000] ];

// paths for wiced_7
points_wiced_7_1 = [ [0.000000000,0.748354662],[0.113930217,1.321120502],[0.438376026,1.806687959],[0.923943495,2.131133764],[1.496709379,2.245063985],[2.069475267,2.131133781],[2.555042745,1.806687990],[2.879488569,1.321120543],[2.993418803,0.748354662],[2.879488586,0.175588821],[2.555042777,-0.309978635],[2.069475308,-0.634424440],[1.496709424,-0.748354662],[0.923943536,-0.634424457],[0.438376058,-0.309978667],[0.113930234,0.175588780],[0.000000000,0.748354662] ];

// paths for wiced_8
points_wiced_8_1 = [ [0.000000000,0.748354657],[0.113930228,1.321120513],[0.438376044,1.806687961],[0.923943515,2.131133756],[1.496709398,2.245063970],[2.069475281,2.131133759],[2.555042754,1.806687966],[2.879488572,1.321120519],[2.993418803,0.748354657],[2.879488575,0.175588801],[2.555042759,-0.309978648],[2.069475288,-0.634424443],[1.496709405,-0.748354657],[0.923943522,-0.634424446],[0.438376049,-0.309978653],[0.113930231,0.175588794],[0.000000000,0.748354657] ];

// paths for wiced_9
points_wiced_9_1 = [ [0.000000000,0.748354649],[0.113930234,1.321120504],[0.438376052,1.806687946],[0.923943522,2.131133737],[1.496709402,2.245063947],[2.069475281,2.131133737],[2.555042751,1.806687946],[2.879488570,1.321120504],[2.993418803,0.748354649],[2.879488570,0.175588794],[2.555042751,-0.309978648],[2.069475281,-0.634424439],[1.496709402,-0.748354649],[0.923943522,-0.634424439],[0.438376052,-0.309978648],[0.113930234,0.175588794],[0.000000000,0.748354649] ];

// paths for wiced_10
points_wiced_10_1 = [ [0.000000000,0.748354649],[0.113930234,1.321120504],[0.438376052,1.806687946],[0.923943522,2.131133737],[1.496709402,2.245063947],[2.069475281,2.131133737],[2.555042751,1.806687946],[2.879488570,1.321120504],[2.993418803,0.748354649],[2.879488570,0.175588794],[2.555042751,-0.309978648],[2.069475281,-0.634424439],[1.496709402,-0.748354649],[0.923943522,-0.634424439],[0.438376052,-0.309978648],[0.113930234,0.175588794],[0.000000000,0.748354649] ];

// paths for wiced_11
points_wiced_11_1 = [ [0.000000000,0.748354674],[0.113930219,1.321120545],[0.438376034,1.806688005],[0.923943511,2.131133808],[1.496709402,2.245064023],[2.069475293,2.131133808],[2.555042769,1.806688005],[2.879488584,1.321120545],[2.993418803,0.748354674],[2.879488584,0.175588804],[2.555042769,-0.309978656],[2.069475293,-0.634424459],[1.496709402,-0.748354674],[0.923943511,-0.634424459],[0.438376034,-0.309978656],[0.113930219,0.175588804],[0.000000000,0.748354674] ];

// paths for wiced_12
points_wiced_12_1 = [ [0.000000000,0.748354649],[0.113930234,1.321120504],[0.438376052,1.806687946],[0.923943522,2.131133737],[1.496709402,2.245063947],[2.069475281,2.131133737],[2.555042751,1.806687946],[2.879488570,1.321120504],[2.993418803,0.748354649],[2.879488570,0.175588794],[2.555042751,-0.309978648],[2.069475281,-0.634424439],[1.496709402,-0.748354649],[0.923943522,-0.634424439],[0.438376052,-0.309978648],[0.113930234,0.175588794],[0.000000000,0.748354649] ];

// paths for screw_hole_2
points_screw_hole_2_1 = [ [0.000000000,0.748354649],[0.113930234,1.321120504],[0.438376052,1.806687946],[0.923943522,2.131133737],[1.496709402,2.245063947],[2.069475281,2.131133737],[2.555042751,1.806687946],[2.879488570,1.321120504],[2.993418803,0.748354649],[2.879488570,0.175588794],[2.555042751,-0.309978648],[2.069475281,-0.634424439],[1.496709402,-0.748354649],[0.923943522,-0.634424439],[0.438376052,-0.309978648],[0.113930234,0.175588794],[0.000000000,0.748354649] ];

module baseplate() {
 color(color_wiced_1) {
  offset(r=1)
  polygon(points=points_wiced_1_1);
 }
}

module polygon_screw_hole_1() {
 color(color_screw_hole_1) {
  polygon(points=points_screw_hole_1_1);
 }
}

module polygon_wiced_3() {
 color(color_wiced_3) {
  polygon(points=points_wiced_3_1);
 }
}

module polygon_wiced_4() {
 color(color_wiced_4) {
  polygon(points=points_wiced_4_1);
 }
}

module polygon_wiced_5() {
 color(color_wiced_5) {
  polygon(points=points_wiced_5_1);
 }
}

module polygon_outline() {
 color(color_outline) {
     render(convexity=2)
  difference() {
      polygon(points=points_outline_2);
      polygon(points=points_outline_1);
  }
 }
}

module polygon_wiced_7() {
 color(color_wiced_7) {
  polygon(points=points_wiced_7_1);
 }
}

module polygon_wiced_8() {
 color(color_wiced_8) {
  polygon(points=points_wiced_8_1);
 }
}

module polygon_wiced_9() {
 color(color_wiced_9) {
  polygon(points=points_wiced_9_1);
 }
}

module polygon_wiced_10() {
 color(color_wiced_10) {
  polygon(points=points_wiced_10_1);
 }
}

module polygon_wiced_11() {
 color(color_wiced_11) {
  polygon(points=points_wiced_11_1);
 }
}

module polygon_wiced_12() {
 color(color_wiced_12) {
  polygon(points=points_wiced_12_1);
 }
}

module polygon_screw_hole_2() {
 color(color_screw_hole_2) {
  polygon(points=points_screw_hole_2_1);
 }
}

module positive() {
    linear_extrude(height=baseHeight) translate(center_wiced_1) baseplate();

    translate(center_outline) {
        linear_extrude(height=edgeHeight+baseHeight)
        render(convexity=2)
        difference() {
            offset(r=edgeWidth+1.5)
            polygon_outline();
            offset(r=1.5)
            polygon_outline();
        }
    }
}

module snap(p1, p2, forward, down, rescale=1) {
    snapStart1 = snapStart-down;
    delta = p2-p1;
    length = norm(delta);
    angle = atan2(delta[1],delta[0]);
    translate(p1) rotate([0,0,angle]) 
    translate([length,0,0]) rotate([90,0,0]) rotate([0,-90,0])
    translate([0,0,length-length*rescale])
    linear_extrude(height=length*rescale) 
    translate([-1.5+2-forward,0])
    polygon([[0,0],[snapThickness,0],[snapThickness,snapStart1+2*snapInset*snapRatio],[-snapInset,snapStart1+snapInset*snapRatio],[0,snapStart1]]);
}

module main() {
    render(convexity=3)
    difference() {
        scale([.95,1]) positive();
        translate(center_screw_hole_1-[8,0,.001]) cylinder(d=screwHoleDiameter, h=baseHeight+0.001,$fn=12);
        translate(center_screw_hole_2-[8,0,.001]) cylinder(d=screwHoleDiameter, h=baseHeight+.001, $fn=12);
        translate(center_screw_hole_1-[-11,0,.001]) cylinder(d=screwHoleDiameter, h=baseHeight+0.001,$fn=12);
        translate(center_screw_hole_2-[-11,0,.001]) cylinder(d=screwHoleDiameter, h=baseHeight+.001, $fn=12);
    }
}

main();

function fixCenter(points,center) = center(points)+center;

snap(fixCenter(points_wiced_4_1,center_wiced_4),fixCenter(points_wiced_3_1,center_wiced_3),-0.1,1,1.5);
snap(fixCenter(points_wiced_8_1,center_wiced_8),fixCenter(points_wiced_7_1,center_wiced_7),1.1,1);
snap(fixCenter(points_wiced_9_1,center_wiced_9), fixCenter(points_wiced_10_1,center_wiced_10),1.5,1);
snap(fixCenter(points_wiced_12_1,center_wiced_12),fixCenter(points_wiced_11_1,center_wiced_11),0.75,1.5);
